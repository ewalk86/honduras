---
title: "Sphygmocor Summary Stats"
author: "Ethan Walker"
date: "20 Feb 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE,
                      fig.width = 8, fig.height = 6)
```


```{r, message=FALSE}
library(tidyverse)
library(magrittr)
library(gridExtra)
library(lubridate)
library(haven)
library(knitr)
```

---

```{r}
#load full datasets
r00_full_joined_sphygmocor <- read_rds("output/r00_full_joined_sphygmocor.RDS")

r00_model_data_outliers_removed <- read_rds("output/r00_model_data_outliers_removed.RDS")
```


```{r}
one_phase <- r00_full_joined_sphygmocor %>% 
  filter(!is.na(aug_index)) %>% 
  summarize(n_distinct(phase))
```


# Variables grouped by study arm
### Data from phase 1
```{r}
summary_stats_study_arm <- r00_model_data_outliers_removed %>% 
  filter(!is.na(aug_index)) %>% 
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  filter(phase == 1) %>% 
  group_by(study_arm, phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, min, median, max) %>% 
  rename("Variable" = var, "Phase" = phase, "Study Arm" = study_arm) 
kable(summary_stats_study_arm, digits = 2)
```

\pagebreak  

# All households
### Data from phase 1
```{r}
summary_stats_all <- r00_model_data_outliers_removed %>% 
  filter(!is.na(aug_index)) %>% 
  filter(!is.na(assigned_stove)) %>%
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  filter(phase == 1) %>% 
  group_by(phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase) %>% 
  select(var, phase, n, mean, sd, min, median, max) %>% 
  rename("Variable" = var, "Phase" = phase) 
kable(summary_stats_all, digits = 2)
```

\pagebreak  

# Variables grouped by study arm and age category
### Data from phase 3 and 4
```{r}
summary_stats_study_arm <- r00_model_data_outliers_removed %>% 
  #split age at 40; >40 = 1, <=40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">=40", "<40")) %>% 
  #split bmi at 26; >26 = 1, <=26 = 0
  mutate(bmi_cat = if_else(bmi >= 26, 1, 0)) %>% 
  select(phase, study_arm, age_cat, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  filter(phase == 3 | phase == 4) %>% 
  select(-phase) %>% 
  group_by(age_cat, study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -age_cat) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, age_cat) %>% 
  select(var, study_arm, age_cat,  n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Study Arm" = study_arm, "Age Category" = age_cat) 
kable(summary_stats_study_arm, digits = 2)
```

\pagebreak  

# Variables grouped by study arm and BMI category
### Data from phase 3 and 4
```{r}
summary_stats_study_arm <- r00_model_data_outliers_removed %>% 
  #split age at 40; >40 = 1, <=40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">=40", "<40")) %>% 
  #split bmi at 26; >26 = 1, <=26 = 0
  mutate(bmi_cat = if_else(bmi >= 26, ">=26", "<26")) %>% 
  select(phase, study_arm, bmi_cat, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  filter(phase == 3 | phase == 4) %>% 
  select(-phase) %>% 
  group_by(bmi_cat, study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -bmi_cat) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, bmi_cat) %>% 
  select(var, study_arm, bmi_cat,  n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Study Arm" = study_arm, "BMI Category" = bmi_cat) 
kable(summary_stats_study_arm, digits = 2)
```

\pagebreak  

# Variables grouped by age category
### Data from phase 1 and 2
```{r}
summary_stats_age_cat <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, age_baseline, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  #split age at 40; >40 = 1, <40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">= 40", "< 40")) %>%
  filter(phase == 1 | phase == 2) %>% 
  select(-study_arm, -age_baseline) %>% 
  group_by(phase, age_cat) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -age_cat, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, age_cat) %>% 
  select(var, phase, age_cat, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Age Category" = age_cat) 
kable(summary_stats_age_cat, digits = 2)
```

\pagebreak  

# Variables grouped by bmi category
### Data from phase 1 and 2
```{r}
summary_stats_bmi_cat <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, age_baseline, bmi, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  #split age at 40; >40 = 1, <40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">= 40", "< 40")) %>%
  #split bmi at 26; >26 = 1, <=26 = 0
  mutate(bmi_cat = if_else(bmi >= 26, ">= 26", "< 26")) %>% 
  filter(phase == 1 | phase == 2) %>% 
  select(-study_arm, -age_baseline, -age_cat, -bmi) %>% 
  group_by(phase, bmi_cat) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -bmi_cat, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, bmi_cat) %>% 
  select(var, phase, bmi_cat, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "BMI Category" = bmi_cat) 
kable(summary_stats_bmi_cat, digits = 2)
```

\pagebreak  

# Variables grouped by phase
```{r}
summary_stats_phase <- r00_model_data_outliers_removed %>% 
  select(phase, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>%
  group_by(phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase) %>% 
  select(var, phase, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Phase" = phase) 
kable(summary_stats_phase, digits = 2)
```

\pagebreak

# Correlation Matrix
### Data from all 6 phases
```{r}
summary_correlation <- r00_model_data_outliers_removed %>% 
  select(aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>% 
  na.exclude(aug_index)
cor(summary_correlation)
```

\pagebreak

```{r}
## summary to include in plots below (geom_text)
sphygmocor_means <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>%  
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  group_by(phase, study_arm) %>%
  summarise(mean(aug_index), sd(aug_index), 
            mean(aug_index_75), sd(aug_index_75),
            mean(hr), sd(hr), 
            mean(pulse_pressure_central), sd(pulse_pressure_central), 
            mean(pulse_pressure_periph), sd(pulse_pressure_periph), 
            mean(sys_bp_central), sd(sys_bp_central), 
            mean(dia_bp_central), sd(dia_bp_central),
            mean(sys_bp_periph), sd(sys_bp_periph), 
            mean(dia_bp_periph), sd(dia_bp_periph)) %>% 
  arrange(study_arm)
#sphygmocor_means
```

# Boxplots by phase
### Means marked and labeled in red  
### Data from all 6 phases
```{r}
## AIx
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, aug_index)) +
  geom_boxplot(aes(phase, aug_index)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(aug_index)`, 
                                    label = round(`mean(aug_index)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(aug_index)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(aug_index)`), 
            size = 2, color = "red") +
  ggtitle("AIx by Phase and Study Arm", 
          subtitle = "means in red; 4 outliers >75 and <-25 removed") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("AIx (%)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## AIx75
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, aug_index_75)) +
  geom_boxplot(aes(phase, aug_index_75)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(aug_index_75)`, 
                                    label = round(`mean(aug_index_75)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(aug_index_75)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(aug_index_75)`), 
            size = 2, color = "red") +
  ggtitle("AIx75 by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("AIx75 (%)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## Central Pulse Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, pulse_pressure_central)) +
  geom_boxplot(aes(phase, pulse_pressure_central)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_central)`, 
                                    label = round(`mean(pulse_pressure_central)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_central)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_central)`), 
            size = 2, color = "red") +
  ggtitle("Central Pulse Pressure by Phase and Study Arm", 
          subtitle = "means in red; 4 outliers >75 removed") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Central Pulse Pressure (mmHg)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## Peripheral Pulse Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(pulse_pressure_periph) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, pulse_pressure_periph)) +
  geom_boxplot(aes(phase, pulse_pressure_periph)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_periph)`, 
                                    label = round(`mean(pulse_pressure_periph)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_periph)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_periph)`), 
            size = 2, color = "red") +
  ggtitle("Peripheral Pulse Pressure by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Peripheral Pulse Pressure (mmHg)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## HR
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_full_joined_sphygmocor %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, hr)) +
  geom_boxplot(aes(phase, hr)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(hr)`, 
                                    label = round(`mean(hr)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(hr)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(hr)`), 
            size = 2, color = "red") +
  ggtitle("HR by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("HR (bpm)") +
  theme_bw()
#sphygmocor_boxplot


## Central Systolic Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_full_joined_sphygmocor %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, sys_bp_central)) +
  geom_boxplot(aes(phase, sys_bp_central)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(sys_bp_central)`, 
                                    label = round(`mean(sys_bp_central)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(sys_bp_central)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(sys_bp_central)`), 
            size = 2, color = "red") +
  ggtitle("Central Systolic BP by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Central Systolic BP (mmHg)") +
  theme_bw()
#sphygmocor_boxplot


## Central Diastolic Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_full_joined_sphygmocor %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, dia_bp_central)) +
  geom_boxplot(aes(phase, dia_bp_central)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(dia_bp_central)`, 
                                    label = round(`mean(dia_bp_central)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(dia_bp_central)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(dia_bp_central)`), 
            size = 2, color = "red") +
  ggtitle("Central Diastolic BP by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Central Diastolic BP (mmHg)") +
  theme_bw()
#sphygmocor_boxplot
```

\pagebreak  

# Bar charts for phases completed
```{r}
# Summary data to include in plot below
phases_completed_sphygmocor <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  group_by(phase, study_arm) %>%
  summarise(number = n()) %>%
  ungroup()

ggplot(phases_completed_sphygmocor, aes(x= phase, y = number, fill = study_arm)) +
    geom_col() +
    theme_bw() +
    facet_wrap(~ study_arm) +
    scale_y_continuous(breaks= seq(0, 120, 10)) +
    theme(text = element_text(size = 16),
          legend.position= "none",
          axis.text.x = element_text(size = 15),
          plot.title = element_text(hjust = 0.5)) +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
    xlab("Study Phase") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ylab("# Women with AIx Data") +
    ggtitle("Sphygmocor measurements completed")
```

\pagebreak

# Number of visits completed with Sphygmocor data
```{r}
all_6_phases <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  group_by(study_arm, house_id) %>% 
  summarize("# Visits" = n()) %>% 
  group_by(`# Visits`, study_arm) %>% 
  summarise(n = n())
kable(all_6_phases)
```

\pagebreak  

# Check that values pulled from sphygmocor match those entered into ODK in the field
## AIx
### aix = ODK variable
### aug_index = Sphygmocor variable
```{r}
data_aix_check <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, aix, aug_index) %>% 
  mutate(aix_check = if_else(aix == round(aug_index, digits = 0), 0, 1)) %>% 
  filter(aix_check == 1)
kable(data_aix_check)
# 16 instances where AIx value entered in field doesn't match the value pulled from database
# Most are rounding errors or explained by mis-entering the value by hand
# Confident that values from database are correct and will use aug_index for analysis
```

\pagebreak  

## Systolic BP
### sysbp = ODK variable
### sys_bp_periph = Sphygmocor variable
```{r}
data_sbp_check <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, sysbp, diabp, sys_bp_periph, dia_bp_periph) %>%
  mutate(sys_bp_check = if_else(sysbp == round(sys_bp_periph, digits = 0), 0, 1)) %>% 
  filter(sys_bp_check == 1) %>% 
  select(-dia_bp_periph, -diabp)
kable(data_sbp_check)
# 6 instances where AIx value entered in field doesn't match the value pulled from database
```

\pagebreak  

## Diastolic BP
### diabp = ODK variable
### dia_bp_periph = Sphygmocor variable
```{r}
data_dbp_check <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, sysbp, diabp, sys_bp_periph, dia_bp_periph) %>% 
  mutate(dia_bp_check = if_else(diabp == round(dia_bp_periph, digits = 0), 0, 1)) %>% 
  filter(dia_bp_check == 1) %>% 
  select(-sys_bp_periph, -sysbp)
kable(data_dbp_check)
# 8 instances where AIx value entered in field doesn't match the value pulled from database
```

\pagebreak   

# Histograms for distribution of measurements
```{r}
# AIx
aix_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
    ggplot()+
    geom_histogram(aes(x = aug_index), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("AIx (%)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("AIx by Phase") 
aix_histogram
```

\pagebreak  

```{r}
# AIx75
aix75_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, aug_index_75) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
    ggplot()+
    geom_histogram(aes(x = aug_index_75), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("AIx75 (%)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("AIx75 by Phase") 
aix75_histogram
```

\pagebreak  

```{r}
# pulse_pressure_central
pulse_pressure_central_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(pulse_pressure_central) %>% 
    ggplot()+
    geom_histogram(aes(x = pulse_pressure_central), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Central Pulse Pressure (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Central Pulse Pressure by Phase") 
pulse_pressure_central_histogram
```

\pagebreak  

```{r}
# HR
hr_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, hr) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(hr) %>% 
    ggplot()+
    geom_histogram(aes(x = hr), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("HR (bpm)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("HR by Phase") 
#hr_histogram

# pulse_pressure_periph
pulse_pressure_peripheral_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, pulse_pressure_periph) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(pulse_pressure_periph) %>% 
    ggplot()+
    geom_histogram(aes(x = pulse_pressure_periph), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Peripheral Pulse Pressure (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Peripheral Pulse Pressure by Phase") 
pulse_pressure_peripheral_histogram

# sys_bp_central
sys_bp_central_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, sys_bp_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(sys_bp_central) %>% 
    ggplot()+
    geom_histogram(aes(x = sys_bp_central), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Central Systolic BP (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Central Systolic BP by Phase") 
#sys_bp_central_histogram

# dia_bp_central
dia_bp_central_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, dia_bp_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(dia_bp_central) %>% 
    ggplot()+
    geom_histogram(aes(x = dia_bp_central), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Central Diastolic BP (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Central Diastolic BP by Phase") 
#dia_bp_central_histogram
```

\pagebreak  

# Line plots across study phases
### Blue = increase from phase to phase for a participant
### Red = decrease from phase to phase for a participant
```{r}
# AIx
line_plots <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index, aug_index_75, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  filter(aug_index < 75) %>% 
  arrange(house_id, phase) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index < lead(aug_index), "TRUE", "FALSE")) %>% 
  ggplot() +
  geom_line(aes(phase, aug_index, color = increase, group = house_id)) +
  theme_bw() +
  ggtitle("AIx Line plots by participant") +
  theme(legend.position = "none") +
  facet_wrap(~study_arm)
line_plots
```

\pagebreak  

```{r}
# AIx 75
line_plots <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index, aug_index_75, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  filter(aug_index < 75) %>% 
  arrange(house_id, phase) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index_75 < lead(aug_index_75), "TRUE", "FALSE")) %>% 
  ggplot() +
  geom_line(aes(phase, aug_index_75, color = increase, group = house_id)) +
  theme_bw() +
  ggtitle("AIx75 Line plots by participant") +
  theme(legend.position = "none") +
  facet_wrap(~study_arm)
line_plots
```

\pagebreak  

```{r}
# Central Pulse Pressure
line_plots <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index, aug_index_75, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  filter(aug_index < 75) %>% 
  arrange(house_id, phase) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(pulse_pressure_central < lead(pulse_pressure_central), 
                            "TRUE", "FALSE")) %>% 
  ggplot() +
  geom_line(aes(phase, pulse_pressure_central, color = increase, group = house_id)) +
  theme_bw() +
  ggtitle("Central Pulse Pressure line plots by participant") +
  theme(legend.position = "none") +
  facet_wrap(~study_arm)
line_plots
```
