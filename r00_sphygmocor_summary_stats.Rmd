---
title: "Sphygmocor Summary Stats"
author: "Ethan Walker"
date: "1 July 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE,
                      fig.width = 8, fig.height = 6)
```


```{r, message=FALSE}
library(tidyverse)
library(magrittr)
library(gridExtra)
library(lubridate)
library(haven)
library(knitr)
```

---

```{r}
# load full dataset
#r00_full_long <- read_rds("output/r00_full_repeated_by_phase.rds")

#load dataset
r00_model_data_outliers_removed <- read_rds("output/r00_model_data_outliers_removed.RDS")

data_outliers_removed <- r00_model_data_outliers_removed %>% 
  # removes 6 observations for participant who wasn't assigned to a study arm
  filter(!is.na(study_arm)) %>% 
  # removes 22 observations for pregnancies
  filter(pregnant_new == 0) %>% 
  # further removes 196 observations (n=1162)
  filter(!is.na(aug_index))

# Dataset for participants who have AIx data for all 6 Phases (107 participants)
r00_data_6phases <- data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) == 6) %>% 
  ungroup()
  

# Dataset for participants who have AIx data for all <6 Phases
r00_data_5phases <- data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) < 6) %>% 
  ungroup() 
```


# Other "test" datasets when assessing missing data and selection bias
## Saving in case I need it for future analyses
## DO NOT USE THIS CHUNK OF CODE ##
```{r}
#load dataset
r00_model_data_outliers_removed <- read_rds("output/r00_model_data_outliers_removed.RDS")

data_outliers_removed <- r00_model_data_outliers_removed %>% 
  # removes 6 observations for participant who wasn't assigned to a study arm
  filter(!is.na(assigned_stove)) %>% 
  # removes 22 observations for pregnancies
  filter(pregnant_new == 0) %>% 
  # further removes 196 observations (n=1162)
  filter(!is.na(aug_index))

# Dataset for participants who have AIx data for all 6 Phases (106 participants)
r00_data_6phases <- data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) == 6) %>% 
  ungroup() %>% 
  mutate(all_phases = "yes")
  

# Dataset for participants who have AIx data for all <6 Phases
r00_data_5phases <- r00_model_data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) < 6) %>% 
  ungroup() %>% 
  mutate(all_phases = "no") %>% 
  filter(!is.na(aug_index)) 

%>% 
  mutate(all_phases2 = if_else(phase == 6 & phase_complete == 0, 1, 0)) %>% 
  group_by(house_id) %>% 
  mutate(all_phases = if_else(sum(all_phases2) == 1 & sum(phase_complete) >2, 
                              "late dropout", "no")) %>% 
  select(-all_phases2) %>% 
  ungroup() %>% 
  filter(!is.na(aug_index)) 
  
  
# Dataset for 46 participants who missed AIx in phase 2 from sphygmo malfunction
r00_data_sphygmo_missing <- r00_model_data_outliers_removed %>%
  mutate(sphygmo_missing_phase2 = as.numeric(sys_bp_final_nurse),
         sphygmo_missing_phase2 = if_else(sphygmo_missing_phase2 > 1, 1, 0),
         sphygmo_missing_phase2 = if_else(is.na(sphygmo_missing_phase2),
                                          0, sphygmo_missing_phase2)) %>% 
  mutate(all_phases2 = "sphygmo missing") %>%  
  group_by(house_id) %>% 
  filter(sum(sphygmo_missing_phase2) == 1) %>% 
  ungroup() %>% 
  filter(!is.na(aug_index)) %>% 
  select(house_id, phase, all_phases2)

%>% 
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  group_by(house_id) %>% 
  # 46 participants missed phase 2 due to sphygmo malfunction
  # 33 did not miss another phase; 13 missed at least one more phase
  mutate(all_phases2 = if_else(sum(phase_complete) == 5, "sphygmo missing", "no")) %>% 
  filter(!is.na(aug_index)) %>% 
  select(house_id, phase, all_phases2) %>%
  ungroup()

r00_5phase_sphygmo_missing <- r00_data_5phases %>% 
  left_join(r00_data_sphygmo_missing, by = c("house_id", "phase")) %>% 
  mutate(all_phases2 = if_else(is.na(all_phases2), "other", all_phases2)) %>% 
  mutate(all_phases = if_else(all_phases2 == "sphygmo missing",
                              all_phases2, all_phases)) %>%
  #select(house_id, phase, all_phases, aug_index)
  select(-all_phases2)

# combine 6 phases and <6 phases datasets with indicator variable to group by
r00_56_combined <- rbind(r00_data_6phases, r00_5phase_sphygmo_missing) %>% 
  group_by(house_id) %>% 
  mutate(all_phases2 = if_else(sum(phase_complete) < 3, "early dropout", "others")) %>% 
  mutate(all_phases2 = if_else(house_id == "QDL024", "others", all_phases2)) %>%
  mutate(all_phases = if_else(all_phases2 == "early dropout", 
                              "early dropout", all_phases)) %>% 
  ungroup() %>% 
  mutate(missed_phases = factor(all_phases,
                                levels = c("early dropout", 
                                           "sphygmo missing", "no", "yes"),
                                labels = c("early dropout", 
                                           "no sphygmo p2", "missed phase", 
                                           "complete case"))) 
%>% 
  filter(missed_phases == "late dropout")
  
%>% 
  mutate(test = if_else(phase == 2 & missed_phases == "missed phase", 1, 0)) %>% 
    group_by(house_id) %>% 
    filter(sum(test) != 1) %>% 
  filter(missed_phases == "complete case" | missed_phases == "missed phase")


# Creating datasets for sensitivity analysis
## based on odd high/low values seen in participants who missed at least one phase
## seen when assessing mean AIx grouped by stove_use_3 and phase
r00_data_phase2 <- r00_model_data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) < 6) %>%
  mutate(phase_2 = if_else(stove_use_3 == "trad" & phase==2,
                            1, 0),
         phase_2 = if_else(phase==3, lag(phase_2), phase_2),
         phase_2 = if_else(phase==4, lag(phase_2), phase_2),
         phase_2 = if_else(phase==5, lag(phase_2), phase_2),
         phase_2 = if_else(phase==6, lag(phase_2), phase_2),
         phase_2 = if_else(phase==1, lead(phase_2), phase_2)) %>% 
  select(house_id, phase, phase_2, aug_index, pulse_pressure_central,
         study_arm, assigned_stove, stove_use_3) %>% 
  filter(phase_2 == 1) %>%    # filtered down to 132 obs from 56 participants
  ungroup()

r00_data_phase3low <- r00_model_data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) < 6) %>%
  mutate(phase_3low = if_else(stove_use_3 == "trad" 
                            & phase==3, 1, 0),
         phase_3low = if_else(phase==4, lag(phase_3low), phase_3low),
         phase_3low = if_else(phase==5, lag(phase_3low), phase_3low),
         phase_3low = if_else(phase==6, lag(phase_3low), phase_3low),
         phase_3low = if_else(phase==2, lead(phase_3low), phase_3low),
         phase_3low = if_else(phase==1, lead(phase_3low), phase_3low)) %>% 
  select(house_id, phase, phase_3low, aug_index, pulse_pressure_central,
         study_arm, assigned_stove, stove_use_3) %>% 
  filter(phase_3low == 1) %>%     # filtered down to 226 obs from 49 participants
  ungroup()

r00_data_phase3hi <- r00_model_data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) < 6) %>%
  mutate(phase_3hi = if_else(stove_use_3 == "justa/imprvd" 
                            & phase==3, 1, 0),
         phase_3hi = if_else(phase==4, lag(phase_3hi), phase_3hi),
         phase_3hi = if_else(phase==5, lag(phase_3hi), phase_3hi),
         phase_3hi = if_else(phase==6, lag(phase_3hi), phase_3hi),
         phase_3hi = if_else(phase==2, lead(phase_3hi), phase_3hi),
         phase_3hi = if_else(phase==1, lead(phase_3hi), phase_3hi)) %>% 
  select(house_id, phase, phase_3hi, aug_index, pulse_pressure_central,
         study_arm, assigned_stove, stove_use_3) %>% 
  filter(phase_3hi == 1) %>%     # filtered down to 81 obs from 17 participants
  ungroup()
  
r00_data_phase4 <- r00_model_data_outliers_removed %>%
  group_by(house_id) %>% 
  #create new var to be able to filter for participants that completed 6 phases
  mutate(phase_complete = if_else(!is.na(aug_index), 1, 0)) %>% 
  filter(sum(phase_complete) < 6) %>%
  mutate(phase_4 = if_else(stove_use_3 == "justa/imprvd" 
                            & phase==4, 1, 0),
         phase_4 = if_else(phase==5, lag(phase_4), phase_4),
         phase_4 = if_else(phase==6, lag(phase_4), phase_4),
         phase_4 = if_else(phase==3, lead(phase_4), phase_4),
         phase_4 = if_else(phase==2, lead(phase_4), phase_4),
         phase_4 = if_else(phase==1, lead(phase_4), phase_4)) %>% 
  select(house_id, phase, phase_4, aug_index, pulse_pressure_central,
         study_arm, assigned_stove, stove_use_3) %>% 
  filter(phase_4 == 1) %>%      # filtered down to 77 obs from 16 participants
  ungroup()
  
r00_highlow_data <- r00_data_phase2 %>% 
  full_join(r00_data_phase3low, by = c("house_id", "phase")) %>% 
  full_join(r00_data_phase3hi, by = c("house_id", "phase")) %>% 
  full_join(r00_data_phase4, by = c("house_id", "phase")) %>%
  mutate(filter_highlow = as.numeric(1))      # 440 obs from 97 participants

highlow_filter_data <- r00_model_data_outliers_removed %>% 
  full_join(r00_highlow_data, by = c("house_id", "phase")) %>% 
  mutate(filter_highlow = if_else(is.na(filter_highlow), 0, 1)) %>% 
  filter(filter_highlow == 0)   # filtered to 722 obs from 133 participants

low_filter_data <- r00_model_data_outliers_removed %>% 
  full_join(r00_highlow_data, by = c("house_id", "phase")) %>% 
  mutate(filter_low = if_else(phase_2==1 | phase_3low==1, 1, 0),
         filter_low = if_else(is.na(filter_low), 0, filter_low)) %>% 
  #select(house_id, phase, phase_2, phase_3low, filter_low)
  filter(filter_low == 0)   # filtered to  795 obs from 148 participants

hi_filter_data <- r00_model_data_outliers_removed %>% 
  full_join(r00_highlow_data, by = c("house_id", "phase")) %>% 
  mutate(filter_hi = if_else(phase_4==1 | phase_3hi==1, 1, 0),
         filter_hi = if_else(is.na(filter_hi), 0, filter_hi)) %>% 
  #select(house_id, phase, phase_2, phase_3low, filter_low)
  filter(filter_hi == 0)    # filtered to  1047 obs from 206 participants
  

# Dataset for participants who missed phase 2
r00_data_phase2_no <- r00_model_data_outliers_removed %>% 
  mutate(phase2 = 1) %>% 
  mutate(phase2 = if_else(phase == 2 & is.na(aug_index), 0, phase2)) %>%  
  group_by(house_id) %>% 
  filter(sum(phase2) == 5) %>% 
  ungroup() 

# Dataset for participants who did not miss phase 2
# removes 440 observations
r00_data_phase2_yes <- r00_model_data_outliers_removed %>%
  mutate(phase2 = 1) %>% 
  mutate(phase2 = if_else(phase == 2 & is.na(aug_index), 0, phase2)) %>%  
  group_by(house_id) %>% 
  filter(sum(phase2) == 6) %>% 
  ungroup() %>%
  #filter(!is.na(aug_index) & phase == 6)
  filter(!is.na(aug_index) & phase == 6 & pregnant_new == 0)
  # further removes 80 observations (n=838)
  filter(!is.na(aug_index)) 
```

# Testing subgroups of data for missing data/selection bias
## Saving in case I need it for future analyses
## DO NOT USE THIS CHUNK OF CODE ##
```{r}
aix_justatrad_diff <- r00_56_combined %>% 
  select(house_id, phase, aug_index, pulse_pressure_central,
         study_arm, assigned_stove, stove_use_3, stove_use_4, all_phases,
         sys_bp_periph, dia_bp_periph, missed_phases) %>%
  group_by(house_id, stove_use_3, missed_phases) %>% 
  summarize(mean_aix = mean(aug_index)) %>% 
  group_by(house_id) %>% 
  filter(n() == 3) %>%   # 61 have AIx readings from all levels of stove_use_3
  ungroup() %>% 
  spread(stove_use_3, mean_aix) %>% 
  mutate(aix_diff = `trad` - `justa/imprvd`) %>% 
  mutate(aix_diff_neg = if_else(aix_diff < -5, 1, 0)) %>% 
  select(house_id, aix_diff, aix_diff_neg)

%>% 
  group_by(missed_phases, aix_diff_neg) %>% 
  summarize(n())
kable(aix_justatrad_diff)


summary_aix_subgroups <- r00_56_combined %>% 
  filter(!is.na(study_arm)) %>% 
  left_join(aix_justatrad_diff, by = "house_id") %>% 
  #filter(!is.na(aix_diff_neg)) %>%
  mutate(SES_weighted_sum = as.numeric(SES_weighted_sum)) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  mutate(sugar = as.numeric(sugar)) %>% 
  mutate(manteca = as.numeric(manteca)) %>% 
  mutate(med_bp = as.numeric(med_bp)) %>% 
  mutate(med_lipids = as.numeric(med_lipids)) %>% 
  mutate(age_multicat = cut(age_baseline, seq(20, 60, 10)),
         age_multicat = factor(age_multicat,
                               levels = c("(20,30]", "(30,40]", "(40,50]", "(50,60]"),
                               labels = c("20-30", "30-40", "40-50", "50-60"))) %>% 
  #filter(missed_phases != "early dropout" & missed_phases != "no sphygmo p2") %>% 
  filter(missed_phases == "complete case") %>%
  #filter(phase == 3 | phase == 4) %>% 
  mutate(test = if_else(missed_phases == "missed phase" &
                        stove_use_3 == "justa/imprvd", 1, 0)) %>% 
  #group_by(house_id) %>%
  #filter(sum(test) > 0) %>%
  group_by(stove_use_3) %>%
  summarise("n" = n(),
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index, na.rm = TRUE), 
            "Age" = mean(age_baseline, na.rm = TRUE),
            "SES" = mean(ses_materials, na.rm = TRUE),
            "%" = n()/516*100,
            "Median" = median(aug_index, na.rm = TRUE))
kable(summary_aix_subgroups, digits = 1)


# Filters for 16 "missed phase, justa/imprvd" participants
filter(house_id != "ANT011" & house_id != "MOM026" & house_id != "OLO050" & 
         house_id != "OLO053" & house_id != "PER062" & house_id != "PER067" & 
         house_id != "ZAC004" & house_id != "ZAC024" & house_id != "ZAC076" & 
         house_id != "ZAC095" & house_id != "CAC060" & house_id != "CER036" & 
         house_id != "OLO028" & house_id != "OLO102" & house_id != "QDL018" & 
         house_id != "ZAC014") %>% 
filter(house_id == "ANT011" | house_id == "MOM026" | house_id == "OLO050" | 
         house_id == "OLO053" | house_id == "PER062" | house_id == "PER067" | 
         house_id == "ZAC004" | house_id == "ZAC024" | house_id == "ZAC076" | 
         house_id == "ZAC095" | house_id == "CAC060" | house_id == "CER036" | 
         house_id == "OLO028" | house_id == "OLO102" | house_id == "QDL018" | 
         house_id == "ZAC014") %>% 
```


# Overall and within subject standard deviations for outcomes
```{r}
aix_sd <- r00_model_data_outliers_removed %>% 
  select(study_arm, aug_index, house_id, pulse_pressure_central) %>% 
  filter(!is.na(study_arm)) %>% 
  filter(!is.na(aug_index)) %>% 
  #filter(phase == 1) %>% 
  summarize("mean aix" = mean(aug_index), "sd aix" = sd(aug_index),
            "mean cpp" = mean(pulse_pressure_central), "sd cpp" = sd(pulse_pressure_central)) 

# Using one-way anova to calculate within-person sd
## Residual mean square is within-person variance
## Square root of RMS is within-person sd
## Source: https://europepmc.org/backend/ptpmcrender.fcgi?accid=PMC2352101&blobtype=pdf
aix_anova_data <- r00_model_data_outliers_removed %>% 
  select(study_arm, aug_index, house_id, pulse_pressure_central) %>% 
  filter(!is.na(study_arm)) %>% 
  filter(!is.na(aug_index)) 

aix_anova_data5 <- r00_data_5phases %>% 
  select(study_arm, aug_index, house_id, pulse_pressure_central) %>% 
  filter(!is.na(study_arm)) %>% 
  filter(!is.na(aug_index)) 

aix_anova_data6 <- r00_data_6phases %>% 
  select(study_arm, aug_index, house_id, pulse_pressure_central) %>% 
  filter(!is.na(study_arm)) %>% 
  filter(!is.na(aug_index)) 

aix_anova <- aov(aug_index ~ house_id, data = aix_anova_data)
summary(aix_anova)
sqrt(85.9) #9.27

aix_anova <- aov(aug_index ~ house_id, data = aix_anova_data5)
summary(aix_anova)
sqrt(88.3) #9.40

aix_anova <- aov(aug_index ~ house_id, data = aix_anova_data6)
summary(aix_anova)
sqrt(83.7) #9.15

cpp_anova <- aov(pulse_pressure_central ~ house_id, data = aix_anova_data)
summary(cpp_anova)
sqrt(22.71) #4.77

# Hand-calc confirming anova calculation above
aix_sd_within_person <- r00_model_data_outliers_removed %>% 
  select(study_arm, aug_index, house_id, pulse_pressure_central) %>% 
  filter(!is.na(study_arm)) %>% 
  filter(!is.na(aug_index)) %>% 
  #filter(phase == 1) %>% 
  group_by(house_id) %>% 
  summarize("meanaix" = mean(aug_index), "sdaix" = sd(aug_index), 
            "varaix" = var(aug_index)) %>% 
  summarize(sqrt(mean(varaix, na.rm = TRUE)))
```

# Assessing outliers by phase and study arm
```{r}
r00_model_data_outliers_aix <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, aug_index, pulse_pressure_central) %>% 
  # removes 6 potential "outliers" with high or low AIx
  filter(aug_index > 75 | aug_index < -25) %>% 
  group_by(phase, study_arm)

r00_model_data_outliers_cpp <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, aug_index, pulse_pressure_central) %>%
  # removes 4 potential "outliers" > 75mmHg CPP
  filter(pulse_pressure_central > 75) %>% 
  group_by(phase, study_arm)
```

# Grouped by assigned stove, all phases
```{r}
summary_stats_stove <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(assigned_stove, aug_index, pulse_pressure_central) %>% 
  group_by(assigned_stove) %>% 
  summarize(n(), mean(aug_index), sd(aug_index), mean(pulse_pressure_central),
            sd(pulse_pressure_central))
summary_stats_stove

summary_stats_stove <- r00_data_phase2_no %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(assigned_stove, aug_index, pulse_pressure_central) %>% 
  group_by(assigned_stove) %>% 
  summarize(n(), mean(aug_index), sd(aug_index), mean(pulse_pressure_central),
            sd(pulse_pressure_central))
summary_stats_stove

summary_stats_stove <- r00_data_phase2_yes %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(assigned_stove, aug_index, pulse_pressure_central) %>% 
  group_by(assigned_stove) %>% 
  summarize(n(), mean(aug_index), sd(aug_index), mean(pulse_pressure_central),
            sd(pulse_pressure_central))
summary_stats_stove
```

# Variables grouped by study arm
### Data from phase 1
```{r}
summary_stats <- r00_model_data_outliers_removed %>% 
  filter(!is.na(aug_index)) %>% 
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  filter(phase == 1) %>% 
  group_by(study_arm, phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, min, median, max) %>% 
  rename("Variable" = var, "Phase" = phase, "Study Arm" = study_arm) 
kable(summary_stats, digits = 2)

summary_stats_phase2_no <- r00_data_phase2_no %>% 
  filter(!is.na(aug_index)) %>% 
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  filter(phase == 1) %>% 
  group_by(study_arm, phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, min, median, max) %>% 
  rename("Variable" = var, "Phase" = phase, "Study Arm" = study_arm) 
kable(summary_stats_phase2_no, digits = 2)

summary_stats_phase2_yes <- r00_data_phase2_yes %>% 
  filter(!is.na(aug_index)) %>% 
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  filter(phase == 1) %>% 
  group_by(study_arm, phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, min, median, max) %>% 
  rename("Variable" = var, "Phase" = phase, "Study Arm" = study_arm) 
kable(summary_stats_phase2_yes, digits = 2)
```

\pagebreak  

# All households
### Data from phase 1
```{r}
summary_stats_all <- r00_data_phase2_yes %>% 
  filter(!is.na(pulse_pressure_central)) %>%
  select(phase, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  filter(phase == 1) %>% 
  group_by(phase) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase) %>% 
  select(var, phase, n, mean, sd, min, median, max) %>% 
  rename("Variable" = var, "Phase" = phase) 
kable(summary_stats_all, digits = 2)
```

\pagebreak 

# AIx grouped by stove use and study arm - all phases
```{r}
## Grouped by stove use

summary_aix_stove_use <- r00_data_phase2 %>% 
  #filter(!is.na(assigned_stove)) %>% 
  #filter(!is.na(aug_index)) %>% 
  #select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
   #      a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  #mutate(salt = as.numeric(salt)) %>% 
  group_by(stove_use_3, phase) %>% 
  summarise("Data" = "all",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/1162*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
kable(summary_aix_stove_use, digits = 1)

summary_aix_stove_use_6phases <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(stove_use_3, phase) %>% 
  summarise("Data" = "6 phases",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/636*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_stove_use_6phases, digits = 1)

summary_aix_stove_use_5phases <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(stove_use_3, phase) %>% 
  summarise("Data" = "<6 phases",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/526*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_stove_use_5phases, digits = 1)

aix_summary_all_stove_use <- rbind(summary_aix_stove_use, summary_aix_stove_use_6phases,
                     summary_aix_stove_use_5phases) 
kable(aix_summary_all_stove_use, digits = 1)


## Grouped by study arm

summary_aix_study_arm <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(study_arm, phase) %>% 
  summarise("Data" = "all",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/1162*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_study_arm, digits = 1)

summary_aix_study_arm_6phases <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(study_arm, phase) %>% 
  summarise("Data" = "6 phases",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/636*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_study_arm_6phases, digits = 1)

summary_aix_study_arm_5phases <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(study_arm, phase) %>% 
  summarise("Data" = "<6 phases",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/526*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_study_arm_5phases, digits = 1)

aix_summary_all_study_arm <- rbind(summary_aix_study_arm, summary_aix_study_arm_6phases,
                     summary_aix_study_arm_5phases) 
kable(aix_summary_all_study_arm, digits = 1)


## Ungrouped

summary_aix <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(phase) %>% 
  summarise("Data" = "all",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/1162*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix, digits = 1)

summary_aix_6phases <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(phase) %>% 
  summarise("Data" = "6 phases",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/636*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_phase2_no, digits = 1)

summary_aix_5phases <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm,
         a_twa, p_twa, age_cat_40, waist_cat, ses_cat_2, salt) %>% 
  mutate(salt = as.numeric(salt)) %>% 
  group_by(phase) %>% 
  summarise("Data" = "<6 phases",
            "Mean AIx" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/526*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
#kable(summary_aix_phase2_yes, digits = 1)

aix_summary_all <- rbind(summary_aix, summary_aix_6phases,
                     summary_aix_5phases) 
kable(aix_summary_all, digits = 1)
```

# CPP grouped by stove use - all phases
```{r}
## Grouped by stove use

summary_cpp_stove_use <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  group_by(stove_use_3) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "All",
            "Mean" = mean(pulse_pressure_central),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/1164*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use, digits = 1)

summary_cpp_stove_use_6phases <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  group_by(stove_use_3) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "6 phases",
            "Mean" = mean(pulse_pressure_central, na.rm = TRUE),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/633*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use_phase2_no, digits = 1)

summary_cpp_stove_use_5phases <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  group_by(stove_use_3) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "<6 phases",
            "Mean" = mean(pulse_pressure_central, na.rm = TRUE),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/531*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use_phase2_yes, digits = 1)

cpp_summary_all_stove_use <- rbind(summary_cpp_stove_use, summary_cpp_stove_use_6phases,
                     summary_cpp_stove_use_5phases) 
kable(cpp_summary_all_stove_use, digits = 1)


## Grouped by stove use

summary_cpp_stove_use <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  group_by(study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "All",
            "Mean" = mean(pulse_pressure_central),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/1164*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use, digits = 1)

summary_cpp_stove_use_6phases <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  group_by(study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "6 phases",
            "Mean" = mean(pulse_pressure_central, na.rm = TRUE),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/633*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use_phase2_no, digits = 1)

summary_cpp_stove_use_5phases <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  group_by(study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "<6 phases",
            "Mean" = mean(pulse_pressure_central, na.rm = TRUE),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/531*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use_phase2_yes, digits = 1)

cpp_summary_all_study_arm <- rbind(summary_cpp_stove_use, summary_cpp_stove_use_6phases,
                     summary_cpp_stove_use_5phases) 
kable(cpp_summary_all_study_arm, digits = 1)


## Ungrouped

summary_cpp <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "All",
            "Mean" = mean(pulse_pressure_central),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/1164*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp, digits = 1)

summary_cpp_6phases <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "6 phases",
            "Mean" = mean(pulse_pressure_central, na.rm = TRUE),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/633*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use_phase2_no, digits = 1)

summary_cpp_5phases <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(pulse_pressure_central)) %>% 
  select(stove_use_3, assigned_stove, pulse_pressure_central, phase, study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Data" = "<6 phases",
            "Mean" = mean(pulse_pressure_central, na.rm = TRUE),
            "SD" = sd(pulse_pressure_central), 
            "n" = n(),
            "%" = n()/531*100,
            "25th" = quantile(pulse_pressure_central, c(.25)),
            "75th" = quantile(pulse_pressure_central, c(.75)),
            "Median" = median(pulse_pressure_central),
            "Min" = min(pulse_pressure_central), 
            "Max" = max(pulse_pressure_central),
            "IQR" = IQR(pulse_pressure_central))
#kable(summary_cpp_stove_use_phase2_yes, digits = 1)

cpp_summary_all <- rbind(summary_cpp, summary_cpp_6phases,
                     summary_cpp_5phases) 
kable(cpp_summary_all, digits = 1)
```

# AIx grouped by study arm - all phases
```{r}
summary_aix_study_arm <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm) %>% 
  group_by(study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Mean" = mean(aug_index),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/1164*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
kable(summary_aix_study_arm, digits = 1)

summary_aix_study_arm_phase2_no <- r00_data_phase2_no %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm) %>% 
  group_by(study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Mean" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/282*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
kable(summary_aix_study_arm_phase2_no, digits = 1)

summary_aix_study_arm_phase2_yes <- r00_data_phase2_yes %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>% 
  select(stove_use_3, assigned_stove, aug_index, phase, study_arm) %>% 
  group_by(study_arm) %>% 
  #group_by(stove_use_3, phase, study_arm) %>% 
  summarise("Mean" = mean(aug_index, na.rm = TRUE),
            "SD" = sd(aug_index), 
            "n" = n(),
            "%" = n()/882*100,
            "25th" = quantile(aug_index, c(.25)),
            "75th" = quantile(aug_index, c(.75)),
            "Median" = median(aug_index),
            "Min" = min(aug_index), 
            "Max" = max(aug_index),
            "IQR" = IQR(aug_index))
kable(summary_aix_study_arm_phase2_yes, digits = 1)
```

\pagebreak  

# Variables grouped by study arm
### Data from phase 3 and 4
```{r}
summary_stats_study_arm <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  na.exclude("Augmentation Index") %>% 
  filter(phase == 3 | phase == 4) %>% 
  select(-phase) %>% 
  group_by(study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var) %>% 
  select(var, study_arm, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Study Arm" = study_arm) 
kable(summary_stats_study_arm, digits = 2)
```

\pagebreak  

# Variables grouped by study arm and BMI category
### Data from phase 3 and 4
```{r}
summary_stats_study_arm <- r00_model_data_outliers_removed %>% 
  #split age at 40; >40 = 1, <=40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">=40", "<40")) %>% 
  #split bmi at 26; >26 = 1, <=26 = 0
  mutate(bmi_cat = if_else(bmi >= 26, ">=26", "<26")) %>% 
  select(phase, study_arm, bmi_cat, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  filter(phase == 3 | phase == 4) %>% 
  select(-phase) %>% 
  group_by(bmi_cat, study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -study_arm, -bmi_cat) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, bmi_cat) %>% 
  select(var, study_arm, bmi_cat,  n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Study Arm" = study_arm, "BMI Category" = bmi_cat) 
kable(summary_stats_study_arm, digits = 2)
```

\pagebreak  

# Variables grouped by age category
### Data from phase 1 and 2
```{r}
summary_stats_age_cat <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, age_baseline, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  #split age at 40; >40 = 1, <40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">= 40", "< 40")) %>%
  filter(phase == 1 | phase == 2) %>% 
  select(-study_arm, -age_baseline) %>% 
  group_by(phase, age_cat) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -age_cat, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, age_cat) %>% 
  select(var, phase, age_cat, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Age Category" = age_cat) 
kable(summary_stats_age_cat, digits = 2)
```

\pagebreak  

# Variables grouped by bmi category
### Data from phase 1 and 2
```{r}
summary_stats_bmi_cat <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, age_baseline, bmi, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central,
         "Pulse Pressure Amplification" = pulse_pressure_amp,
         "Pulse Pressure Amplification Ratio" = pulse_pressure_amp_ratio) %>% 
  na.exclude("Augmentation Index") %>% 
  #split age at 40; >40 = 1, <40 = 0
  mutate(age_cat = if_else(age_baseline >= 40, ">= 40", "< 40")) %>%
  #split bmi at 26; >26 = 1, <=26 = 0
  mutate(bmi_cat = if_else(bmi >= 26, ">= 26", "< 26")) %>% 
  filter(phase == 1 | phase == 2) %>% 
  select(-study_arm, -age_baseline, -age_cat, -bmi) %>% 
  group_by(phase, bmi_cat) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -bmi_cat, -phase) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, bmi_cat) %>% 
  select(var, phase, bmi_cat, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "BMI Category" = bmi_cat) 
kable(summary_stats_bmi_cat, digits = 2)
```

\pagebreak  

# Line plots across phases
```{r}
line_plot_data <- r00_model_data_outliers_removed %>% 
  arrange(house_id, date_sphygmo) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index < lead(aug_index), "TRUE", "FALSE")) 

aix_line_plot <- ggplot(line_plot_data) +
  geom_line(aes(phase, aug_index, color = increase, group = house_id)) +
  theme_minimal() +
  theme(legend.position = "none")
aix_line_plot

line_plot_data <- r00_data_5phases %>% 
  arrange(house_id, date_sphygmo) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index < lead(aug_index), "TRUE", "FALSE")) 

aix_line_plot <- ggplot(line_plot_data, aes(group = house_id)) +
  geom_line(aes(phase, aug_index, color = increase)) +
  theme_minimal() +
  theme(legend.position = "none")
aix_line_plot

line_plot_data <- r00_data_6phases %>% 
  arrange(house_id, date_sphygmo) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index < lead(aug_index), "TRUE", "FALSE")) 

aix_line_plot <- ggplot(line_plot_data) +
  geom_line(aes(phase, aug_index, color = increase, group = house_id)) +
  theme_minimal() +
  theme(legend.position = "none")
aix_line_plot
```

\pagebreak  

# Variables grouped by phase
```{r}
summary_stats_phase <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>%
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  group_by(phase, study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -phase, -study_arm) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Phase" = phase, "Arm" = study_arm) 
kable(summary_stats_phase, digits = 2)

summary_stats_phase6 <- r00_data_6phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>%
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  group_by(phase, study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -phase, -study_arm) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Phase" = phase, "Arm" = study_arm) 
kable(summary_stats_phase6, digits = 2)

summary_stats_phase5 <- r00_data_5phases %>% 
  filter(!is.na(assigned_stove)) %>% 
  filter(!is.na(aug_index)) %>%
  select(phase, study_arm, "Augmentation Index" = aug_index, "Heart Rate" = hr, 
         "Systolic BP Peripheral" = sys_bp_periph, "Diastolic BP Peripheral" = dia_bp_periph, 
         "MAP Peripheral" = map_periph, "Systolic BP Central" = sys_bp_central, 
         "Diastolic BP Central" = dia_bp_central, "MAP Central" = map_central, 
         "Augmentation Pressure" = aug_pressure, "Augmentation Index 75" = aug_index_75,
         "Pulse Pressure Peripheral" = pulse_pressure_periph, 
         "Pulse Pressure Central" = pulse_pressure_central) %>% 
  group_by(phase, study_arm) %>% 
  summarise_all(funs("_mean" = mean, "_sd" = sd, "_median" = median, 
                     "_min" = min, "_max" = max, "_n" = n())) %>% 
  gather(var, value, -phase, -study_arm) %>% 
  separate(var, into = c("var", "stat"), sep = "__") %>% 
  spread(stat, value) %>% 
  arrange(var, phase, study_arm) %>% 
  select(var, phase, study_arm, n, mean, sd, median, max, min) %>% 
  rename("Variable" = var, "Phase" = phase, "Arm" = study_arm) 
kable(summary_stats_phase5, digits = 2)
```

\pagebreak

# Correlation Matrix
### Data from all 6 phases
```{r}
summary_correlation <- r00_model_data_outliers_removed %>% 
  select(aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>% 
  na.exclude(aug_index)
cor(summary_correlation)
```

\pagebreak

```{r}
## summary to include in plots below (geom_text)
sphygmocor_means <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>%  
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  group_by(phase, study_arm) %>%
  summarise(mean(aug_index), sd(aug_index), 
            mean(aug_index_75), sd(aug_index_75),
            mean(hr), sd(hr), 
            mean(pulse_pressure_central), sd(pulse_pressure_central), 
            mean(pulse_pressure_periph), sd(pulse_pressure_periph), 
            mean(sys_bp_central), sd(sys_bp_central), 
            mean(dia_bp_central), sd(dia_bp_central),
            mean(sys_bp_periph), sd(sys_bp_periph), 
            mean(dia_bp_periph), sd(dia_bp_periph)) %>% 
  arrange(study_arm)
#sphygmocor_means
```

# Boxplots by phase
### Means marked and labeled in red  
### Data from all 6 phases
```{r}
## AIx
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, aug_index)) +
  geom_boxplot(aes(phase, aug_index)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(aug_index)`, 
                                    label = round(`mean(aug_index)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(aug_index)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(aug_index)`), 
            size = 2, color = "red") +
  ggtitle("AIx by Phase and Study Arm", 
          subtitle = "means in red; 4 outliers >75 and <-25 removed") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("AIx (%)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## AIx75
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, aug_index_75)) +
  geom_boxplot(aes(phase, aug_index_75)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(aug_index_75)`, 
                                    label = round(`mean(aug_index_75)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(aug_index_75)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(aug_index_75)`), 
            size = 2, color = "red") +
  ggtitle("AIx75 by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("AIx75 (%)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## Central Pulse Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, pulse_pressure_central)) +
  geom_boxplot(aes(phase, pulse_pressure_central)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_central)`, 
                                    label = round(`mean(pulse_pressure_central)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_central)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_central)`), 
            size = 2, color = "red") +
  ggtitle("Central Pulse Pressure by Phase and Study Arm", 
          subtitle = "means in red; 4 outliers >75 removed") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Central Pulse Pressure (mmHg)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## Peripheral Pulse Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_model_data_outliers_removed %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph,
         sys_bp_central, dia_bp_central, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(pulse_pressure_periph) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, pulse_pressure_periph)) +
  geom_boxplot(aes(phase, pulse_pressure_periph)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_periph)`, 
                                    label = round(`mean(pulse_pressure_periph)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_periph)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(pulse_pressure_periph)`), 
            size = 2, color = "red") +
  ggtitle("Peripheral Pulse Pressure by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Peripheral Pulse Pressure (mmHg)") +
  theme_bw()
sphygmocor_boxplot
```

\pagebreak  

```{r}
## HR
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_full_joined_sphygmocor %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, hr)) +
  geom_boxplot(aes(phase, hr)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(hr)`, 
                                    label = round(`mean(hr)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(hr)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(hr)`), 
            size = 2, color = "red") +
  ggtitle("HR by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("HR (bpm)") +
  theme_bw()
#sphygmocor_boxplot


## Central Systolic Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_full_joined_sphygmocor %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, sys_bp_central)) +
  geom_boxplot(aes(phase, sys_bp_central)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(sys_bp_central)`, 
                                    label = round(`mean(sys_bp_central)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(sys_bp_central)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(sys_bp_central)`), 
            size = 2, color = "red") +
  ggtitle("Central Systolic BP by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Central Systolic BP (mmHg)") +
  theme_bw()
#sphygmocor_boxplot


## Central Diastolic Pressure
# boxplots by phase, faceted by study arm
# means plotted in red
sphygmocor_boxplot <- r00_full_joined_sphygmocor %>% 
  select(phase, study_arm, aug_index, hr, sys_bp_periph, dia_bp_periph, map_periph,
         sys_bp_central, dia_bp_central, map_central, aug_pressure, aug_index_75,
         pulse_pressure_periph, pulse_pressure_central) %>%
  na.exclude(aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>% 
  ggplot(aes(phase, dia_bp_central)) +
  geom_boxplot(aes(phase, dia_bp_central)) +
  geom_text(data = sphygmocor_means, aes(phase, `mean(dia_bp_central)`, 
                                    label = round(`mean(dia_bp_central)`, digits = 1)),
                                    size = 4, vjust = -2.5, color = "red") +
  geom_line(data = sphygmocor_means, aes(phase, `mean(dia_bp_central)`, group = study_arm), 
            color = "red") +
  geom_point(data = sphygmocor_means, aes(phase, `mean(dia_bp_central)`), 
            size = 2, color = "red") +
  ggtitle("Central Diastolic BP by Phase and Study Arm", subtitle = "means in red") +
  facet_wrap(~study_arm) +
  xlab("Study Phase") +
  ylab("Central Diastolic BP (mmHg)") +
  theme_bw()
#sphygmocor_boxplot
```

\pagebreak  

# Bar charts for phases completed
```{r}
# Summary data to include in plot below
phases_completed_sphygmocor <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  group_by(phase, study_arm) %>%
  summarise(number = n()) %>%
  ungroup()

ggplot(phases_completed_sphygmocor, aes(x= phase, y = number, fill = study_arm)) +
    geom_col() +
    theme_bw() +
    facet_wrap(~ study_arm) +
    scale_y_continuous(breaks= seq(0, 120, 10)) +
    theme(text = element_text(size = 16),
          legend.position= "none",
          axis.text.x = element_text(size = 15),
          plot.title = element_text(hjust = 0.5)) +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
    xlab("Study Phase") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ylab("# Women with AIx Data") +
    ggtitle("Sphygmocor measurements completed")
```

\pagebreak

# Number of visits completed with Sphygmocor data
```{r}
all_6_phases <- r00_model_data_outliers_removed %>% 
  filter(!is.na(assigned_stove)) %>% 
  select(house_id, phase, study_arm, aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  filter(!is.na(aug_index)) %>% 
  group_by(house_id, study_arm) %>% 
  summarize("# Visits" = n()) %>% 
  group_by(`# Visits`, study_arm) %>% 
  summarise(n = n())
kable(all_6_phases)
```

\pagebreak  

# Check that values pulled from sphygmocor match those entered into ODK in the field
## AIx
### aix = ODK variable
### aug_index = Sphygmocor variable
```{r}
data_aix_check <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, aix, aug_index) %>% 
  mutate(aix_check = if_else(aix == round(aug_index, digits = 0), 0, 1)) %>% 
  filter(aix_check == 1)
kable(data_aix_check)
# 16 instances where AIx value entered in field doesn't match the value pulled from database
# Most are rounding errors or explained by mis-entering the value by hand
# Confident that values from database are correct and will use aug_index for analysis
```

\pagebreak  

## Systolic BP
### sysbp = ODK variable
### sys_bp_periph = Sphygmocor variable
```{r}
data_sbp_check <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, sysbp, diabp, sys_bp_periph, dia_bp_periph) %>%
  mutate(sys_bp_check = if_else(sysbp == round(sys_bp_periph, digits = 0), 0, 1)) %>% 
  filter(sys_bp_check == 1) %>% 
  select(-dia_bp_periph, -diabp)
kable(data_sbp_check)
# 6 instances where AIx value entered in field doesn't match the value pulled from database
```

\pagebreak  

## Diastolic BP
### diabp = ODK variable
### dia_bp_periph = Sphygmocor variable
```{r}
data_dbp_check <- r00_full_joined_sphygmocor %>% 
  select(house_id, phase, study_arm, sysbp, diabp, sys_bp_periph, dia_bp_periph) %>% 
  mutate(dia_bp_check = if_else(diabp == round(dia_bp_periph, digits = 0), 0, 1)) %>% 
  filter(dia_bp_check == 1) %>% 
  select(-sys_bp_periph, -sysbp)
kable(data_dbp_check)
# 8 instances where AIx value entered in field doesn't match the value pulled from database
```

\pagebreak   

# Histograms for distribution of measurements
```{r}
# AIx
aix_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, aug_index) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
    ggplot()+
    geom_histogram(aes(x = aug_index), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("AIx (%)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("AIx by Phase") 
aix_histogram
```

\pagebreak  

```{r}
# AIx75
aix75_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, aug_index_75) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
    ggplot()+
    geom_histogram(aes(x = aug_index_75), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("AIx75 (%)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("AIx75 by Phase") 
aix75_histogram
```

\pagebreak  

```{r}
# pulse_pressure_central
pulse_pressure_central_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(pulse_pressure_central) %>% 
    ggplot()+
    geom_histogram(aes(x = pulse_pressure_central), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Central Pulse Pressure (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Central Pulse Pressure by Phase") 
pulse_pressure_central_histogram
```

\pagebreak  

```{r}
# HR
hr_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, hr) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(hr) %>% 
    ggplot()+
    geom_histogram(aes(x = hr), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("HR (bpm)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("HR by Phase") 
#hr_histogram

# pulse_pressure_periph
pulse_pressure_peripheral_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, pulse_pressure_periph) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(pulse_pressure_periph) %>% 
    ggplot()+
    geom_histogram(aes(x = pulse_pressure_periph), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Peripheral Pulse Pressure (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Peripheral Pulse Pressure by Phase") 
pulse_pressure_peripheral_histogram

# sys_bp_central
sys_bp_central_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, sys_bp_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(sys_bp_central) %>% 
    ggplot()+
    geom_histogram(aes(x = sys_bp_central), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Central Systolic BP (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Central Systolic BP by Phase") 
#sys_bp_central_histogram

# dia_bp_central
dia_bp_central_histogram <- r00_model_data_outliers_removed %>%
  select(phase, study_arm, dia_bp_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(dia_bp_central) %>% 
    ggplot()+
    geom_histogram(aes(x = dia_bp_central), bins = 30) +
    facet_wrap(~phase, ncol = 2) +
    theme_bw() +
    scale_fill_manual(values=c("#33CC99",
                               "#339999",
                               "#FF9900",
                               "#330099")) +
   xlab("Central Diastolic BP (mmHg)") +
   ylab("Number of measurements") +
   theme(text = element_text(size = 16),
          legend.position= "none",
          plot.title = element_text(hjust = 0.5)) +
   ggtitle("Central Diastolic BP by Phase") 
#dia_bp_central_histogram
```

\pagebreak  

# Line plots across study phases
### Blue = increase from phase to phase for a participant
### Red = decrease from phase to phase for a participant
```{r}
# AIx
line_plots <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index, aug_index_75, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  filter(aug_index < 75) %>% 
  arrange(house_id, phase) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index < lead(aug_index), "TRUE", "FALSE")) %>% 
  ggplot() +
  geom_line(aes(phase, aug_index, color = increase, group = house_id)) +
  theme_bw() +
  ggtitle("AIx Line plots by participant") +
  theme(legend.position = "none") +
  facet_wrap(~study_arm)
line_plots
```

\pagebreak  

```{r}
# AIx 75
line_plots <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index, aug_index_75, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  filter(aug_index < 75) %>% 
  arrange(house_id, phase) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(aug_index_75 < lead(aug_index_75), "TRUE", "FALSE")) %>% 
  ggplot() +
  geom_line(aes(phase, aug_index_75, color = increase, group = house_id)) +
  theme_bw() +
  ggtitle("AIx75 Line plots by participant") +
  theme(legend.position = "none") +
  facet_wrap(~study_arm)
line_plots
```

\pagebreak  

```{r}
# Central Pulse Pressure
line_plots <- r00_model_data_outliers_removed %>% 
  select(house_id, phase, study_arm, aug_index, aug_index_75, pulse_pressure_central) %>% 
  mutate(study_arm = factor(study_arm, levels = c(1, 2), labels = c("Arm 1", "Arm 2"))) %>%
  na.exclude(aug_index) %>% 
  filter(aug_index < 75) %>% 
  arrange(house_id, phase) %>% 
  group_by(house_id) %>% 
  mutate(increase = if_else(pulse_pressure_central < lead(pulse_pressure_central), 
                            "TRUE", "FALSE")) %>% 
  ggplot() +
  geom_line(aes(phase, pulse_pressure_central, color = increase, group = house_id)) +
  theme_bw() +
  ggtitle("Central Pulse Pressure line plots by participant") +
  theme(legend.position = "none") +
  facet_wrap(~study_arm)
line_plots
```
